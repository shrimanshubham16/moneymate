<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  
  <!-- PWA Meta Tags -->
  <meta name="theme-color" content="#00d4ff" />
  <meta name="description" content="Track your income, expenses, investments, and financial health all in one place" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="FinFlow" />
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="/manifest.json" />
  
  <!-- Apple Touch Icons -->
  <link rel="apple-touch-icon" href="/icons/icon-192x192.png" />
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/icon-152x152.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/icon-192x192.png" />
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/icon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/icon-16x16.png" />
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <title>FinFlow</title>
  
  <!-- Inline styles for fallback UI (always works even if JS fails) -->
  <style>
    .app-loading-fallback {
      position: fixed;
      inset: 0;
      background: linear-gradient(135deg, #0a0a0f 0%, #1a1a2e 50%, #0a0a0f 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-family: 'Poppins', -apple-system, BlinkMacSystemFont, sans-serif;
      color: #ffffff;
      z-index: 99999;
      padding: 20px;
      text-align: center;
    }
    .app-loading-fallback.hidden { display: none; }
    .loading-spinner {
      width: 50px;
      height: 50px;
      border: 3px solid rgba(0, 212, 255, 0.2);
      border-top-color: #00d4ff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    .loading-text {
      margin-top: 20px;
      font-size: 16px;
      color: #00d4ff;
    }
    .error-container {
      max-width: 400px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 100, 100, 0.3);
      border-radius: 16px;
      padding: 30px;
      backdrop-filter: blur(10px);
    }
    .error-icon {
      font-size: 48px;
      margin-bottom: 16px;
    }
    .error-title {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 12px;
      color: #ff6b6b;
    }
    .error-message {
      font-size: 14px;
      color: #aaa;
      line-height: 1.6;
      margin-bottom: 20px;
    }
    .refresh-btn {
      background: linear-gradient(135deg, #00d4ff, #00ff88);
      color: #000;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      margin: 8px;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .refresh-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 20px rgba(0, 212, 255, 0.4);
    }
    .clear-btn {
      background: transparent;
      color: #00d4ff;
      border: 1px solid #00d4ff;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      margin: 8px;
      transition: background 0.2s;
    }
    .clear-btn:hover {
      background: rgba(0, 212, 255, 0.1);
    }
    .help-text {
      font-size: 12px;
      color: #666;
      margin-top: 20px;
    }
    .help-text code {
      background: rgba(0, 212, 255, 0.2);
      padding: 2px 6px;
      border-radius: 4px;
      color: #00d4ff;
    }
  </style>
</head>

<body>
  <div id="root"></div>
  
  <!-- Fallback UI shown while loading or if JS fails -->
  <div id="app-fallback" class="app-loading-fallback">
    <div id="loading-state">
      <div class="loading-spinner"></div>
      <div class="loading-text">Loading FinFlow...</div>
    </div>
    <div id="error-state" style="display: none;">
      <div class="error-container">
        <div class="error-icon">‚ö†Ô∏è</div>
        <div class="error-title">App Failed to Load</div>
        <div class="error-message">
          This usually happens due to cached files from a previous version. 
          Please try one of these options:
        </div>
        <button class="refresh-btn" onclick="location.reload(true)">
          üîÑ Hard Refresh
        </button>
        <button class="clear-btn" onclick="clearCacheAndReload()">
          üßπ Clear Cache & Reload
        </button>
        <div class="help-text">
          Or press <code>Ctrl+Shift+R</code> (Windows) / <code>Cmd+Shift+R</code> (Mac)
        </div>
      </div>
    </div>
  </div>
  
  <!-- Inline script to detect load failures (doesn't depend on external files) -->
  <script>
    window.__APP_LOADED__ = false;
    
    // Function to clear cache and reload
    function clearCacheAndReload() {
      // Unregister service worker
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.getRegistrations().then(function(registrations) {
          for (var registration of registrations) {
            registration.unregister();
          }
        });
      }
      // Clear caches
      if ('caches' in window) {
        caches.keys().then(function(names) {
          for (var name of names) {
            caches.delete(name);
          }
        });
      }
      // Clear localStorage (except token to preserve login)
      var token = localStorage.getItem('token');
      localStorage.clear();
      if (token) localStorage.setItem('token', token);
      
      // Reload after a short delay
      setTimeout(function() {
        location.reload(true);
      }, 500);
    }
    
    // Show error state if app doesn't load within 10 seconds
    var loadTimeout = setTimeout(function() {
      if (!window.__APP_LOADED__) {
        document.getElementById('loading-state').style.display = 'none';
        document.getElementById('error-state').style.display = 'block';
      }
    }, 10000);
    
    // Catch JavaScript errors
    window.onerror = function(msg, url, line, col, error) {
      // Check if it's a module load error
      if (msg && (msg.includes('Unexpected token') || msg.includes('Failed to fetch') || 
          msg.includes('Loading module') || msg.includes('SyntaxError'))) {
        clearTimeout(loadTimeout);
        document.getElementById('loading-state').style.display = 'none';
        document.getElementById('error-state').style.display = 'block';
      }
    };
    
    // Hide fallback when React mounts
    window.__hideAppFallback__ = function() {
      window.__APP_LOADED__ = true;
      clearTimeout(loadTimeout);
      var fallback = document.getElementById('app-fallback');
      if (fallback) fallback.classList.add('hidden');
    };
  </script>
  
  <script type="module" crossorigin src="/src/main.tsx"></script>
</body>

</html>
